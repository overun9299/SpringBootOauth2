"use strict";!function(e,s,n){var t="https://g.csdnimg.cn/user-tooltip/1.7/",i={company:"<img src="+t+"images/icon-company.png />",domainGrey:"<img src="+t+"images/icon-domain-grey.png />",domain:"<img src="+t+"images/icon-domain.png />",vip:"<img src="+t+"images/icon-vip.png />",writer:"<img src="+t+"images/icon-writer.png />"},a={getUserProfileUrl:"https://me.csdn.net/api/external/user/getUserProfile",checkFollowUrl:"https://me.csdn.net/api/relation/check",doFollowUrl:"https://me.csdn.net/api/relation/create",doUnfollowUrl:"https://me.csdn.net/api/relation/destroy",ref:"miniprofile",defaultUserProfile:{username:"yanlinpu",avatarurl:"https://profile.csdnimg.cn/1/1/B/1_yanlinpu",vip:!1,expert:!1,nickname:"木林森001",fans_num:"2万",identity:[{name:"专家"},{name:"版主"}],medal:[{type:"203",codename:"111",image:"https://g.csdnimg.cn/static/user-medal/1024huodong.svg"}]}};if(void 0===e.csdn&&(e.csdn={}),!jQuery)return!1;!function(e){var n=s.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=e,s.getElementsByTagName("head")[0].appendChild(n)}(t+"user-tooltip.css"),e.csdn.userTooltip=function(t){function o(){v[m].flag&&(n("#csdn-userTooltip .person_deliver").mouseover(function(){n(this).hasClass("person_deliver_letter")&&n(this).html("取&nbsp;&nbsp;&nbsp;消")}),n("#csdn-userTooltip .person_deliver").mouseout(function(){n(this).hasClass("person_deliver_letter")&&n(this).html("已关注")})),n("#csdn-userTooltip .person_deliver").click(function(){var s,t;if(y){var i=n(this);if(0==v[m].flag){if(!i.hasClass("person_deliver_letter_un"))return!1;s=a.doFollowUrl,n.ajax({type:"post",url:s,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:JSON.stringify({username:m}),success:function(s){200==parseInt(s.code)&&(i.html("已关注").removeClass("person_deliver_letter_un").addClass("person_deliver_letter"),i.mouseover(function(){i.html("取&nbsp;&nbsp;&nbsp;消")}),i.mouseout(function(){i.html("已关注")})),e.csdn&&e.csdn.watchBtnChange&&e.csdn.watchBtnChange(1,m),v[m].flag=!0,v[m].followClass="person_deliver person_deliver_letter",v[m].followStr="已关注"}})}else t=a.doUnfollowUrl,n.ajax({type:"post",url:t,xhrFields:{withCredentials:!0},crossDomain:!0,data:JSON.stringify({username:m}),dataType:"json",success:function(s){200==parseInt(s.code)&&(i.html("关注").removeClass("person_deliver_letter").addClass("person_deliver_letter_un"),i.unbind("mouseover"),i.unbind("mouseout")),e.csdn&&e.csdn.watchBtnChange&&e.csdn.watchBtnChange(0,m),v[m].flag=!1,v[m].followClass="person_deliver person_deliver_letter_un",v[m].followStr="关注"}})}else e.location.href="https://passport.csdn.net/"})}function r(e){var s,n=e.offset(),t=n.left,i=n.top,a=e.width(),o=e.height(),r=e[0].getBoundingClientRect(),l={};return r&&Number(r.top,10)<162?(s="left:"+(t-50+a/2)+"px;top:"+(i+o+15)+"px",l.isBottom=!0):s="left:"+(t-50+a/2)+"px;top:"+(i-165)+"px",l.position=s,l}function l(){n("#csdn-userTooltip").remove()}t&&n.extend(a,t);var d,c,p,m,u,f,h={},v={},g="",_=!1,w='<svg id="csdnc-m-blank" viewBox="0 0 1024 1024" width="100%" height="100%" fill="#ccc"><path d="M516.266311 77.945505a8.788601 8.788601 0 0 0-8.532622 0L121.461878 292.455629a8.319307 8.319307 0 0 0-4.351637 7.252729v424.583284c0 2.986418 1.663861 5.75952 4.351637 7.252729l386.271811 214.510124a8.788601 8.788601 0 0 0 8.532622 0l386.271811-214.510124a8.319307 8.319307 0 0 0 4.351637-7.252729V299.708358a8.319307 8.319307 0 0 0-4.351637-7.252729L516.266311 77.945505z m37.671528-67.066412l386.314473 214.552788a85.027581 85.027581 0 0 1 43.900342 74.276477v424.583284c0 30.802766-16.809266 59.216399-43.943005 74.276477l-386.27181 214.552788c-26.024498 14.462795-57.808516 14.462795-83.875678 0l-386.314473-214.552788a85.027581 85.027581 0 0 1-43.900342-74.276477V299.708358c0-30.802766 16.809266-59.216399 43.943005-74.276477L470.019498 10.879093c26.024498-14.462795 57.808516-14.462795 83.875677 0z"></path></svg>';s.domain="csdn.net";var y=function(e){for(var n=s.cookie.split("; "),t=0;t<n.length;t++){var i=n[t].split("=");if(i[0]==e&&"UD"==e)return decodeURIComponent(i[1]);if(i[0]==e)return decodeURI(i[1])}}("UserName");n(s).on("mouseenter","img[username], #csdn-userTooltip",function(s){function t(e,s,t,i,o,r,l,d,c,p,u,f,h,v,g){g=g||"<a href='javascript:void(0)' class='person_deliver person_deliver_letter_un'>关注</a>";var _="<div id='csdn-userTooltip' style='"+f.position+"' data-mod='popu_60' class='tracking-ad"+(f.isBottom?" csdn-userTooltip-pos":" csdn-userTooltip-default")+"'><div class='person-info-div clearfix'><dt class='touxiang'><img src='"+e+"'></dt><div class='csdn-left-info'><dd class='person_info'><em class='name"+(s?" name_short":"")+"'>"+t+"</em>"+v+"</dd>"+c+h+"</div></div><div class='follow-div clearfix'>"+g+(r?"<em class='fav'>粉丝 "+r+"</em>":"")+"<a class='visoter'  target='_blank'href='http://me.csdn.net/"+m+"?ref="+a.ref+"'>访问主页</a><div style = 'height:16px;width:1px;background:#F0F0F0;margin:11px 8px 0;float:right!important;'></div><a class='visoter' target='_blank' href='https://im.csdn.net/im/main.html?userName="+m+"'>私信</a></div>";n("body").append(_)}function l(){n("#csdn-userTooltip").length&&n("#csdn-userTooltip").remove(),m=u.attr("username");var s,l,d,c,T,x,C,b,U,k,j,B="";if(!(p.closest("#csdn-userTooltip").length<=0))return!1;n("#csdn-userTooltip").remove(),v[m]?(s=v[m].followClass,l=v[m].followStr,d=v[m].avatarurl,c=v[m].nickname,T=v[m].isVip,x=v[m].hasDomain,C=v[m].isBlogWriter,b=v[m].favsCount,U=v[m].interestname,k=v[m].huistr,B=r(u),f=T?"<span class='icon_vip'>"+i.vip+"</span>":"",f+=C?"<span class='icon_writer'>"+i.writer+"</span>":"",g=x?"<li class='has-domain'>"+i.domain+"<a href='https://"+x+".blog.csdn.net'>"+x+".blog.csdn.net</a></li>":"<li class='medal no-domain'>"+i.domainGrey+"暂未设置自定义域名</li>",g="<dd class='csdn-domain'>"+g+"</dd>",y?(s&&l&&(j="<a href='javascript:void(0)' class='"+s+"'>"+l+"</a>"),y===m&&(j=""),t(d,U,c,T,C,b,s,l,k,void 0,_,B,g,f,j),o()):(t(d,U,c,T,C,b,s,l,k,void 0,_,B,g,f,j),n("#csdn-userTooltip .person_deliver").click(function(){e.location.href="https://passport.csdn.net/"}))):n.ajax({type:"get",url:a.getUserProfileUrl+"?username="+m,contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(s){var l,d,c,p,m,T,x,C,b,U,k,F,D="",N="",S="",P="",V=!1;if(200===Number(s.code,10)){if(l=s.data||a.defaultUserProfile,!(F=l.username))return!1;if(d=l.avatarurl,c=l.nickname||F,p=l.fans_num,m=l.vip,T=l.domain,x=l.expert,C=l.medal?l.medal:[],b=C.length,b>0&&(V=!0),f=m?"<span class='icon_vip'>"+i.vip+"</span>":"",f+=x?"<span class='icon_writer'>"+i.writer+"</span>":"",g=T?"<li class='has-domain'>"+i.domain+"<a href='https://"+T+".blog.csdn.net'>"+T+".blog.csdn.net</a></li>":"<li class='medal no-domain'>"+i.domainGrey+"暂未设置自定义域名</li>",g="<dd class='csdn-domain'>"+g+"</dd>",V){C.length>99999?(U=99999,k=!0):U=C.length;for(var I=0;I<U;I++)S+="<li class='medal' title='"+C[I].codename+"'><img src='"+C[I].image+"' alt='胸章'></li>";k&&(S+='<li class="medal medal-icon">'+w+C.length+"</li>"),S="<dd class='medals'><ul>"+S+"</ul></dd>"}else S="<li class='medal no-medals'>一个勋章都没有...</li>",S="<dd class='medals'><ul>"+S+"</ul></dd>";if(null!=l.identity)for(var E=0;E<l.identity.length;E++){l.identity[E].name&&(E<l.identity.length-1?P+=l.identity[E].name+"<em>|</em>":P+=l.identity[E].name)}if(y){var G=a.checkFollowUrl+"?follows="+F;n.ajax({type:"get",url:G,xhrFields:{withCredentials:!0},dataType:"json",success:function(e){var s;200===e.code&&e.data&&(0===e.data[F]?(D="person_deliver person_deliver_letter_un",N="关注",_=!1):(D="person_deliver person_deliver_letter",N="已关注",_=!0)),B=r(u),D&&D&&(s="<a href='javascript:void(0)' class='"+D+"'>"+N+"</a>"),y===F&&(s=""),t(d,P,c,m,x,p,D,N,S,b,_,B,g,f,s),h[F]={},h[F].avatarurl=d,h[F].nickname=c,h[F].isVip=m,h[F].hasDomain=T,h[F].isBlogWriter=x,h[F].favsCount=p,h[F].interestname=P,h[F].followClass=D,h[F].followStr=N,h[F].huistr=S,h[F].huicount=b,h[F].flag=_,v[F]=h[F],o()}})}else B=r(u),t(d,P,c,m,x,p,D,N,S,b,_,B,g,f,j),n("#csdn-userTooltip .person_deliver").click(function(){e.location.href="https://passport.csdn.net/"}),h[F]={},h[F].avatarurl=d,h[F].nickname=c,h[F].isVip=m,h[F].hasDomain=T,h[F].isBlogWriter=x,h[F].favsCount=p,h[F].interestname=P,h[F].huistr=S,h[F].huicount=b,v[F]=h[F]}},error:function(e){console.warn(e)}})}var s=s||e.event;return p=n(s.target||s.srcElement),u=n(this),clearTimeout(c),clearTimeout(d),null!=n(this).attr("username")&&(d=setTimeout(l,200)),!1}),n(s).on("mouseleave","img[username]",function(e){return clearTimeout(d),c=setTimeout(l,200),!1}),n(s).on("mouseleave","#csdn-userTooltip",function(e){return clearTimeout(c),l(),!1})}}(window,document,jQuery),$(function(){window.csdn.userTooltip()});